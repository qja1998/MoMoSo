
    # 등장인물 문자열 생성
    characters_str = "\n".join([
        f"- 이름: {char['name']}, 역할: {char['role']}, 나이: {char['age']}, 성별: {char['sex']}, 직업: {char['job']}, 프로필: {char['profile']}"
        for char in characters
    ])

    # 새 소설 레코드 생성
    novel_id = insert_novel(genre, title, worldview, synopsis, characters_str)
    
    if not novel_id:
        raise ValueError("소설 ID가 생성되지 않음.")

    # 첫 챕터 생성
    first_chapter_text = generate_first_chapter(genre, title, worldview, synopsis, characters)
    
    if not first_chapter_text:
        raise ValueError("생성된 챕터 내용이 없음.")

    # 파일 저장
    output_dir = os.path.join(os.getcwd(), "novel")
    os.makedirs(output_dir, exist_ok=True)
    file_name = os.path.join(output_dir, f"{title}_1화.txt")

    try:
        with open(file_name, 'w', encoding='utf-8') as file:
            file.write(first_chapter_text)
        print(f"파일 저장 완료: {file_name}")
    except Exception as e:
        print(f"파일 저장 오류: {e}")

    # DB 저장
    insert_chapter(novel_id, 1, first_chapter_text)
    print(f"소설 ID: {novel_id}, 1화 저장 완료!")