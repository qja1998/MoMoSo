Date.prototype.addDays=function(b){var a=new Date(this.valueOf());a.setDate(a.getDate()+b);return a;};var PopupLayerNovel=jindo.$Class({_LOCAL_STORAGE_POPUP_NAME:"popupLayer_pc",_COOKIE_POPUP_NAME:"novel_co_p",_MAX_POPUP_COUNT:50,_MAX_APPEAR_COUNT:3,_TYPE_COUNT:"count",_TYPE_FINISH:"finish",_TYPE_CLOSE:"close",_TYPE_MORE:"more",$init:function(){this._oLocalStorage=new LocalStorageUtil();},add:function(a){var b=this._addToLocalStorage(a);this._addDisappearPopup(b);},_addDisappearPopup:function(c){var a=new Date();for(var b=0;b<c.length;b++){var d=c[b];if(d.count>=this._MAX_APPEAR_COUNT){this._addToCookie(d,this._TYPE_COUNT);continue;}if(d.finishDate!=null||d.finishDate>=a){this._addToCookie(d,this._TYPE_FINISH);continue;}if(d.closeDate!=null||d.closeDate>=a){this._addToCookie(d,this._TYPE_CLOSE);continue;}if(d.moreDate!=null||d.moreDate>=a){this._addToCookie(d,this._TYPE_MORE);continue;}}},_addToCookie:function(c,h){var b;switch(h){case"finish":b=c.finishDate;break;case"close":b=c.closeDate;break;case"more":b=c.moreDate;break;default:b=new Date().addDays(365);}var d=this._dateFormattt(b);sValue=jindo.$Cookie().get(this._COOKIE_POPUP_NAME)||"";if(!sValue){sValue=c.seq+"_"+d;jindo.$Cookie().set(this._COOKIE_POPUP_NAME,sValue,365,location.host);return;}var a=sValue.split(",");for(var f=0,e=a.length;f<e;f++){var j=a[f].split("_");if(j[0]==c.seq){a.splice(f,1);break;}}var g=(c.seq+"_"+d);a=[g].concat(a);a.splice(this._MAX_POPUP_COUNT,1);jindo.$Cookie().set(this._COOKIE_POPUP_NAME,a.join(","),365,location.host);},_dateFormattt:function(d){var g;if(typeof d=="string"){g=new Date(Date.parse(d));}else{g=d;}var e=g.getMonth()+1;var b=g.getDate();var a=g.getHours();var f=g.getMinutes();var c=g.getSeconds();e=e>=10?e:"0"+e;b=b>=10?b:"0"+b;a=a>=10?a:"0"+a;f=f>=10?f:"0"+f;c=c>=10?c:"0"+c;return g.getFullYear()+"-"+e+"-"+b+" "+a+":"+f+":"+c;},_addToLocalStorage:function(a){var d=[];var f=this._oLocalStorage.get(this._LOCAL_STORAGE_POPUP_NAME);if(f!=null){d=JSON.parse(decodeURIComponent(atob(f.replace(/\"/gi,""))));var b=-1;for(var c=0;c<d.length;c++){var e=d[c];if(a.seq==e.seq){a=e;a.count+=1;b=c;}}if(b==-1){a.count=1;}else{d.splice(b,1);}}else{a.count=1;}d.push(a);if(d.length>=this._MAX_POPUP_COUNT){d.shift();}this._oLocalStorage.set(this._LOCAL_STORAGE_POPUP_NAME,btoa(encodeURIComponent(JSON.stringify(d))));return d;},finish:function(a){this._addUserClickDate(a,this._TYPE_FINISH);},close:function(a){this._addUserClickDate(a,this._TYPE_CLOSE);},more:function(a){this._addUserClickDate(a,this._TYPE_MORE);},_addUserClickDate:function(a,d){var e=[];var g=this._oLocalStorage.get(this._LOCAL_STORAGE_POPUP_NAME);if(g!=null){e=JSON.parse(decodeURIComponent(atob(g.replace(/\"/gi,""))));var b=-1;for(var c=0;c<e.length;c++){var f=e[c];if(a.seq==f.seq){a.count=f.count;b=c;}}if(b!=-1){e.splice(b,1);}}else{console.log("error localStoragePopupNovelObject is null");}switch(d){case"finish":a.finishDate=new Date().addDays(a.finishDays);break;case"close":a.closeDate=new Date().addDays(a.closeDays);break;case"more":a.moreDate=new Date().addDays(a.moreDays);break;}e.push(a);this._oLocalStorage.set(this._LOCAL_STORAGE_POPUP_NAME,btoa(encodeURIComponent(JSON.stringify(e))));this._addToCookie(a,d);return e;},});